<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <title>Agendamento de Consultas</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description"
        content="A Clinicare Saúde é uma clínica de saúde, centro médico, dedicado ao cuidado abrangente dos pacientes. Oferecemos serviços médicos em diversas especialidades, como cardiologia, pediatria, endocrinologia e dermatologia.">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/forms.css">
    <link rel="icon" href="../imagens/logo/logo2t.png" type="image/png">
    <script src="../js/validaAgendamento.js"></script>

</head>

<body>
    <header>
        <img src="../imagens/logo/logo2t.png" alt="Logomarca da Clínica Médica Clinicare Saúde" width="80" height="80">
        <h1>Clinicare Saúde</h1>
    </header>
    <nav>
        <ul class="formataul">
            <li><a href="index.html">Home</a></li>
            <li><a href="galeria.html">Galeria</a></li>
            <li><a href="contato.html">Contato</a></li>
            <li><a href="login.html">Login</a></li>
            <li><a href="agendamento.html">Agendamento</a></li>
        </ul>
    </nav>
    <main>
        <h2>Agendamento de Consultas</h2>
        <form name="formAgendamento" action="../../back-end/agendamento/cadastra-agendamentos.php" method="post">
            <fieldset>
                <legend>Informações da Consulta</legend>

                <div>
                    <label for="espec">Especialidades</label>
                    <select name="espec" id="espec" required>
                        <option value="" disabled selected>Selecione...</option>
                    </select>
                    <span></span>
                </div>

                <div>
                    <label for="medespec">Médico Especialista </label>
                    <select name="medespec" id="medespec" required>
                        <option value="" disabled selected>Selecione...</option>
                    </select>
                    <span></span>
                </div>

                <div>
                    <label for="dhconsulta">Data e Horário</label> <br>
                    <input type="datetime-local" name="dhconsulta" id="dhconsulta" required>
                    <span></span>
                </div>

            </fieldset>

            <fieldset>
                <legend>Informações do Paciente</legend>

                <div>
                    <label for="nome">Nome</label>
                    <input type="text" name="nome" id="nome" minlength="5" maxlength="50">
                    <span></span>
                </div>

                <fieldset>
                    <legend>Sexo</legend>
                    <div>
                        <div>
                            <input type="radio" id="masculino" name="sexo" value="masculino">
                            <label for="masculino">Masculino</label>
                            <span></span>
                        </div>

                        <div>
                            <input type="radio" id="feminino" name="sexo" value="feminino">
                            <label for="feminino">Feminino</label>
                        </div>
                        <span></span>
                    </div>

                </fieldset>

                <div>
                    <label for="email">E-mail</label>
                    <input type="email" id="email" name="email">
                    <span></span>
                </div>

                <div>
                    <label for="tel">Telefone</label>
                    <input type="tel" id="tel" name="tel">
                    <span></span>
                </div>
            </fieldset>
            <button>Agendar</button>
        </form>
    </main>
    <footer>
        <div class="contatos">
            <h2 class="rodape">Contatos</h2>
            <address>
                <div>
                    <img src="../imagens/icones-rodape/phone-call.png" alt="Telefone" width="30" height="30">
                    <a href="tel:+5511221857319">(11) 22185-7319</a>
                </div>

                <div>
                    <img src="../imagens/icones-rodape/email.png" alt="E-mail" width="30" height="30">
                    <a href="mailto:contato@clinicare.com">contato@clinicare.com</a>
                </div>
                <div>
                    <img src="../imagens/icones-rodape/linkedin.png" alt="E-mail" width="30" height="30">
                    <a href="https://www.linkedin.com/feed/">LinkedIn</a>
                </div>
                <div>
                    <img src="../imagens/icones-rodape/facebook.png" alt="E-mail" width="30" height="30">
                    <a href="https://facebook.com/">Facebook</a>
                </div>
                <div>
                    <img src="../imagens/icones-rodape/instagram.png" alt="E-mail" width="30" height="30">
                    <a href="https://www.instagram.com/">Instagram</a>
                </div>
            </address>
        </div>

        <div class="endereco">
            <h2 class="rodape">Endereço</h2>
            <address>
                <p>Av. Ipiranga, 200 - Centro Histórico de São Paulo, São Paulo - SP, 01046-010</p>
                <iframe
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3657.6076582602714!2d-46.64742622356306!3d-23.54660976105252!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94ce584e9cf3e6eb%3A0x67dbedea02edad73!2sEdif%C3%ADcio%20Copan%20-%20Av.%20Ipiranga%2C%20200%20-%20Centro%20Hist%C3%B3rico%20de%20S%C3%A3o%20Paulo%2C%20S%C3%A3o%20Paulo%20-%20SP%2C%2001046-010!5e0!3m2!1spt-BR!2sbr!4v1682343648842!5m2!1spt-BR!2sbr"
                    width="400" height="150" style="border:0;" allowfullscreen="" loading="lazy">
                </iframe>
            </address>
        </div>
        <div class="copy">
            <p>&copy; 2023 Clínica Médica Clinicare</p>
        </div>
    </footer>
    <script>
        function buscaEspecialidade() {
            const listaEspecialidades = document.querySelector("#espec");
            //listaEspecialidades.innerHTML = "";

            let xhr = new XMLHttpRequest();
            xhr.open("GET", "../../back-end/agendamento/buscaEspecialidade.php");

            xhr.onload = function () {
                if (xhr.status == 200) {
                    const especialidades = JSON.parse(xhr.responseText);

                    for (let i = 0; i < especialidades.length; i++) {
                        let novoOption = document.createElement("option");
                        novoOption.textContent = especialidades[i];
                        novoOption.value = especialidades[i];
                        listaEspecialidades.appendChild(novoOption);
                    }
                } else {
                    console.error("Falha: " + xhr.status + xhr.responseText);
                }
            };

            xhr.onerror = () => console.log("Erro de rede");
            xhr.send();
        }

        function buscaMedico() {
            const listaMedicos = document.getElementById("medespec");
            listaMedicos.innerHTML = "";

            let especSelecionada = document.getElementById("espec").value;

            let xhr = new XMLHttpRequest();
            xhr.open("GET", "../../back-end/agendamento/buscaMedico.php?especialidade=" + especSelecionada);

            xhr.onload = function () {
                if (xhr.status == 200) {
                    const medicos = JSON.parse(xhr.responseText);

                    for (let i = 0; i < medicos.length; i++) {
                        let novoOption = document.createElement("option");
                        novoOption.textContent = medicos[i].nome;
                        novoOption.value = medicos[i].codigo;
                        listaMedicos.appendChild(novoOption);
                    }
                } else {
                    console.error("Falha: " + xhr.status + xhr.responseText);
                }
            };

            xhr.onerror = () => console.log("Erro de rede");
            xhr.send();
        }

        window.onload = function () {
            buscaEspecialidade();
            const selectEspec = document.getElementById("espec");
            selectEspec.addEventListener("change", buscaMedico);
        }
    </script>

</body>

</html>